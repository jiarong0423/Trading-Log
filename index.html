<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c1{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c3{background-color:#ffffff;max-width:451.4pt;padding:72pt 72pt 72pt 72pt}.c2{height:11pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c3 doc-content"><p class="c1"><span class="c0">&lt;!DOCTYPE html&gt;</span></p><p class="c1"><span class="c0">&lt;html lang=&quot;zh-TW&quot;&gt;</span></p><p class="c1"><span class="c0">&lt;head&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;meta charset=&quot;UTF-8&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;title&gt;&#20132;&#26131;&#26085;&#35468;&#30435;&#25511;&#34920;&lt;/title&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;style&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; * { margin: 0; padding: 0; box-sizing: border-box; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; body { font-family: &#39;Microsoft JhengHei&#39;, Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); padding: 30px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; h1 { text-align: center; color: #667eea; margin-bottom: 30px; font-size: 2.5em; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .form-section { background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .form-group { display: flex; flex-direction: column; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; label { font-weight: bold; margin-bottom: 8px; color: #333; font-size: 14px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; input, select, textarea { padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; transition: border-color 0.3s; background: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; textarea { resize: vertical; min-height: 80px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .positions-section { background: #fff; border: 2px solid #667eea; border-radius: 10px; padding: 20px; margin-bottom: 20px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .positions-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #eee; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-item { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #667eea; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; align-items: center; position: relative; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-item.long { border-left-color: #28a745; background: #f0f9f4; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-item.short { border-left-color: #dc3545; background: #fef5f5; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-item.futures { border-left-width: 6px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-field { display: flex; flex-direction: column; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-field label { font-size: 12px; color: #666; margin-bottom: 5px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-field input, .position-field select { padding: 8px; font-size: 13px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-field input.current-price-field { border: 2px solid #ff9800; background: #fff9e6; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .position-pnl { grid-column: 1 / -1; text-align: center; font-size: 18px; font-weight: bold; padding: 12px; background: white; border-radius: 5px; margin-top: 5px; border: 2px solid #ddd; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .remove-position-btn { position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-size: 16px; line-height: 1; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .remove-position-btn:hover { background: #c82333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .button-group { display: flex; gap: 15px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; button { padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-primary { background: #667eea; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-primary:hover { background: #5568d3; transform: translateY(-2px); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-success { background: #28a745; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-success:hover { background: #218838; transform: translateY(-2px); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-secondary { background: #6c757d; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-secondary:hover { background: #5a6268; transform: translateY(-2px); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-danger { background: #dc3545; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-danger:hover { background: #c82333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-add { background: #17a2b8; color: white; padding: 8px 20px; font-size: 14px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-add:hover { background: #138496; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-info { background: #17a2b8; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-info:hover { background: #138496; transform: translateY(-2px); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-warning { background: #ffc107; color: #333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .btn-warning:hover { background: #e0a800; transform: translateY(-2px); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; th { background: #667eea; color: white; padding: 15px; text-align: left; font-weight: bold; font-size: 14px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; td { padding: 12px 15px; border-bottom: 1px solid #eee; font-size: 13px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; tr:hover { background: #f8f9fa; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; tr.open-position { background: #fff9e6; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .profit { color: #28a745; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .loss { color: #dc3545; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .unrealized { color: #ff9800; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .correct { color: #28a745; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .incorrect { color: #dc3545; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-bottom: 30px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card.unrealized-card { background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card.profit-card { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card.loss-card { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card h3 { font-size: 14px; margin-bottom: 10px; opacity: 0.9; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .stat-card .value { font-size: 24px; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .delete-btn { background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .delete-btn:hover { background: #c82333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .close-btn { background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-right: 5px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .close-btn:hover { background: #218838; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .update-price-btn { background: #ff9800; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-right: 5px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .update-price-btn:hover { background: #f57c00; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .edit-btn { background: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; margin-right: 5px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .edit-btn:hover { background: #138496; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .hidden { display: none !important; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .settlement-section { background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .settlement-controls { display: flex; gap: 15px; align-items: end; margin-bottom: 20px; flex-wrap: wrap; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .settlement-summary { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; padding: 20px; border-radius: 10px; margin-top: 20px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .settlement-summary.negative { background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .summary-item { text-align: center; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .summary-item .label { font-size: 12px; opacity: 0.9; margin-bottom: 5px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .summary-item .value { font-size: 24px; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .badge-open { background: #ffc107; color: #333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .badge-closed { background: #6c757d; color: white; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 15px; width: 90%; max-width: 700px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); max-height: 85vh; overflow-y: auto; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .close-modal { font-size: 28px; font-weight: bold; color: #999; cursor: pointer; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .close-modal:hover { color: #333; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .current-price-input { border: 2px solid #ff9800 !important; background: #fff9e6 !important; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .price-update-section { background: #fff3e0; border: 2px solid #ff9800; border-radius: 10px; padding: 15px; margin-bottom: 15px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .price-update-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; align-items: center; padding: 10px; background: white; border-radius: 5px; margin-bottom: 10px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .price-update-row label { font-size: 13px; font-weight: bold; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .total-unrealized { font-size: 24px; font-weight: bold; text-align: center; padding: 15px; border-radius: 8px; margin-top: 15px; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .total-unrealized.profit { background: #d4edda; color: #28a745; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; .total-unrealized.loss { background: #f8d7da; color: #dc3545; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; @media (max-width: 768px) { .position-item { grid-template-columns: 1fr; } .button-group { flex-direction: column; } button { width: 100%; } .settlement-controls { flex-direction: column; align-items: stretch; } .price-update-row { grid-template-columns: 1fr; } }</span></p><p class="c1"><span class="c0">&nbsp; &lt;/style&gt;</span></p><p class="c1"><span class="c0">&lt;/head&gt;</span></p><p class="c1"><span class="c0">&lt;body&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;div class=&quot;container&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;h1&gt;&#128202; &#20132;&#26131;&#26085;&#35468;&#31995;&#32113;&lt;/h1&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-section&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 style=&quot;margin-bottom: 20px; color: #667eea;&quot;&gt;&#26032;&#22686;&#20132;&#26131;&#35352;&#37636;&lt;/h2&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;form id=&quot;tradeForm&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-grid&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;date&quot;&gt;&#20132;&#26131;&#26085;&#26399; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;date&quot; id=&quot;date&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;positionStatus&quot;&gt;&#37096;&#20301;&#29376;&#24907; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;positionStatus&quot; required onchange=&quot;toggleExitFields()&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;closed&quot;&gt;&#24050;&#24179;&#20489;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;open&quot;&gt;&#26410;&#24179;&#20489;(&#25345;&#20489;&#20013;)&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;strategy&quot;&gt;&#38918;&#21218;/&#36870;&#21218; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;strategy&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#38918;&#21218;&quot;&gt;&#38918;&#21218;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#36870;&#21218;&quot;&gt;&#36870;&#21218;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot; id=&quot;judgementGroup&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;judgement&quot;&gt;&#21028;&#26039;&#26159;&#21542;&#27491;&#30906;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;judgement&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#27491;&#30906;&quot;&gt;&#27491;&#30906;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#37679;&#35492;&quot;&gt;&#37679;&#35492;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;positions-section&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;positions-header&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3 style=&quot;color: #667eea;&quot;&gt;&#128200; &#20132;&#26131;&#37096;&#20301;(&#21487;&#26032;&#22686;&#22810;&#27284;)&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-add&quot; onclick=&quot;addPosition()&quot;&gt;&#10133; &#26032;&#22686;&#37096;&#20301;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;positionsContainer&quot;&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-grid&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;entryReason&quot;&gt;&#36914;&#22580;&#21407;&#22240; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;textarea id=&quot;entryReason&quot; placeholder=&quot;&#25551;&#36848;&#36914;&#22580;&#30340;&#25216;&#34899;&#38754;&#12289;&#31820;&#30908;&#38754;&#25110;&#22522;&#26412;&#38754;&#21407;&#22240;...&quot; required&gt;&lt;/textarea&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot; id=&quot;exitReasonGroup&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;exitReason&quot;&gt;&#20986;&#22580;&#21407;&#22240;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;textarea id=&quot;exitReason&quot; placeholder=&quot;&#25551;&#36848;&#20986;&#22580;&#30340;&#21407;&#22240;...&quot;&gt;&lt;/textarea&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;notes&quot;&gt;&#20633;&#35387;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;textarea id=&quot;notes&quot; placeholder=&quot;&#20854;&#20182;&#24515;&#24471;&#25110;&#35264;&#23519;...&quot;&gt;&lt;/textarea&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;button-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;submit&quot; class=&quot;btn-primary&quot;&gt;&#10133; &#26032;&#22686;&#35352;&#37636;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-info&quot; onclick=&quot;showOpenPositionsModal()&quot;&gt;&#128203; &#26410;&#24179;&#20489;&#37096;&#20301;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-success&quot; onclick=&quot;downloadHTML()&quot;&gt;&#128190; &#19979;&#36617;&#26085;&#35468;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-secondary&quot; onclick=&quot;exportCSV()&quot;&gt;&#128202; &#21295;&#20986;CSV&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-danger&quot; onclick=&quot;clearAllData()&quot;&gt;&#128465;&#65039; &#28165;&#31354;&#35352;&#37636;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/form&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;stats&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#24050;&#24179;&#20489;&#20132;&#26131;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;totalTrades&quot;&gt;0&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card&quot; id=&quot;realizedPnLCard&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#24050;&#23526;&#29694;&#25613;&#30410;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;totalPnL&quot;&gt;$0&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card unrealized-card&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#26410;&#23526;&#29694;&#25613;&#30410;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;unrealizedPnL&quot;&gt;$0&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card unrealized-card&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#26410;&#24179;&#20489;&#37096;&#20301;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;openPositionsCount&quot;&gt;0&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#21213;&#29575;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;winRate&quot;&gt;0%&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;stat-card&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#21028;&#26039;&#27491;&#30906;&#29575;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;value&quot; id=&quot;correctRate&quot;&gt;0%&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;settlement-section&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 style=&quot;margin-bottom: 20px; color: #667eea;&quot;&gt;&#128197; &#25613;&#30410;&#32080;&#31639;&#22577;&#34920;(&#20677;&#35336;&#31639;&#24050;&#24179;&#20489;)&lt;/h2&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;settlement-controls&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot; style=&quot;min-width: 150px;&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;settlementYear&quot;&gt;&#36984;&#25799;&#24180;&#20221;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;settlementYear&quot; onchange=&quot;updateSettlementMonths()&quot;&gt;&lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot; style=&quot;min-width: 150px;&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;settlementMonth&quot;&gt;&#36984;&#25799;&#26376;&#20221;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;settlementMonth&quot;&gt;&lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-info&quot; onclick=&quot;generateDailySettlement()&quot;&gt;&#128202; &#26085;&#32080;&#31639;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-info&quot; onclick=&quot;generateWeeklySettlement()&quot;&gt;&#128202; &#36913;&#32080;&#31639;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-info&quot; onclick=&quot;generateMonthlySettlement()&quot;&gt;&#128202; &#26376;&#32080;&#31639;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-success&quot; onclick=&quot;exportSettlementCSV()&quot;&gt;&#128190; &#21295;&#20986;&#22577;&#34920;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;settlementResult&quot;&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div style=&quot;overflow-x: auto;&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;table id=&quot;tradeTable&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;thead&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tr&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#29376;&#24907;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#26085;&#26399;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#20132;&#26131;&#37096;&#20301;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#38918;/&#36870;&#21218;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#25613;&#30410;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#36914;&#22580;&#21407;&#22240;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#20986;&#22580;&#21407;&#22240;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#21028;&#26039;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#20633;&#35387;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;th&gt;&#25805;&#20316;&lt;/th&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/thead&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tbody id=&quot;tradeBody&quot;&gt;&lt;/tbody&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/table&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &lt;div id=&quot;closePositionModal&quot; class=&quot;modal&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-content&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-header&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 style=&quot;color: #667eea;&quot;&gt;&#128228; &#24179;&#20489;&#37096;&#20301;&lt;/h2&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;close-modal&quot; onclick=&quot;closeModal(&#39;closePositionModal&#39;)&quot;&gt;&amp;times;&lt;/span&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;form id=&quot;closePositionForm&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;hidden&quot; id=&quot;closeTradeId&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;closeDate&quot;&gt;&#24179;&#20489;&#26085;&#26399; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;date&quot; id=&quot;closeDate&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;closePositionsContainer&quot;&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;closeExitReason&quot;&gt;&#20986;&#22580;&#21407;&#22240; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;textarea id=&quot;closeExitReason&quot; placeholder=&quot;&#25551;&#36848;&#20986;&#22580;&#30340;&#21407;&#22240;...&quot; required&gt;&lt;/textarea&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;form-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label for=&quot;closeJudgement&quot;&gt;&#21028;&#26039;&#26159;&#21542;&#27491;&#30906; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select id=&quot;closeJudgement&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#27491;&#30906;&quot;&gt;&#27491;&#30906;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#37679;&#35492;&quot;&gt;&#37679;&#35492;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;button-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;submit&quot; class=&quot;btn-success&quot;&gt;&#9989; &#30906;&#35469;&#24179;&#20489;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-secondary&quot; onclick=&quot;closeModal(&#39;closePositionModal&#39;)&quot;&gt;&#21462;&#28040;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/form&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &lt;div id=&quot;openPositionsModal&quot; class=&quot;modal&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-content&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-header&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 style=&quot;color: #ffc107;&quot;&gt;&#128203; &#26410;&#24179;&#20489;&#37096;&#20301;&#21015;&#34920;&lt;/h2&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;close-modal&quot; onclick=&quot;closeModal(&#39;openPositionsModal&#39;)&quot;&gt;&amp;times;&lt;/span&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;openPositionsList&quot;&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &lt;div id=&quot;editPositionModal&quot; class=&quot;modal&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-content&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;modal-header&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h2 style=&quot;color: #17a2b8;&quot;&gt;&#9999;&#65039; &#32232;&#36655;&#26410;&#24179;&#20489;&#37096;&#20301;&lt;/h2&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;span class=&quot;close-modal&quot; onclick=&quot;closeModal(&#39;editPositionModal&#39;)&quot;&gt;&amp;times;&lt;/span&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;form id=&quot;editPositionForm&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;hidden&quot; id=&quot;editTradeId&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;price-update-section&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;p style=&quot;margin-bottom: 15px; color: #666; font-weight: bold;&quot;&gt;&#26356;&#26032;&#25910;&#30436;&#20729;/&#29694;&#20729;:&lt;/p&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;editPositionsContainer&quot;&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div id=&quot;editTotalUnrealized&quot; class=&quot;total-unrealized&quot;&gt;&#32317;&#26410;&#23526;&#29694;&#25613;&#30410;: $0.00&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;button-group&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;submit&quot; class=&quot;btn-success&quot;&gt;&#128190; &#20786;&#23384;&#26356;&#26032;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;btn-secondary&quot; onclick=&quot;closeModal(&#39;editPositionModal&#39;)&quot;&gt;&#21462;&#28040;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/form&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &lt;/div&gt;</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">&nbsp; &lt;script&gt;</span></p><p class="c1"><span class="c0">let trades = JSON.parse(localStorage.getItem(&#39;trades&#39;)) || [];</span></p><p class="c1"><span class="c0">let positionCounter = 0;</span></p><p class="c1"><span class="c0">let currentSettlementData = null;</span></p><p class="c1"><span class="c0">let currentSettlementType = null;</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">document.getElementById(&#39;date&#39;).valueAsDate = new Date();</span></p><p class="c1"><span class="c0">addPosition();</span></p><p class="c1"><span class="c0">displayTrades();</span></p><p class="c1"><span class="c0">updateStats();</span></p><p class="c1"><span class="c0">initializeSettlementYears();</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function toggleExitFields() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const status = document.getElementById(&#39;positionStatus&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const exitReasonGroup = document.getElementById(&#39;exitReasonGroup&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const judgementGroup = document.getElementById(&#39;judgementGroup&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (status === &#39;open&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; exitReasonGroup.style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; judgementGroup.style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.querySelectorAll(&#39;[name=&quot;exitPrice&quot;]&#39;).forEach(el =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.closest(&#39;.position-field&#39;).style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.removeAttribute(&#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.querySelectorAll(&#39;[name=&quot;currentPrice&quot;]&#39;).forEach(el =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.closest(&#39;.position-field&#39;).style.display = &#39;flex&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; exitReasonGroup.style.display = &#39;flex&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; judgementGroup.style.display = &#39;flex&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.querySelectorAll(&#39;[name=&quot;exitPrice&quot;]&#39;).forEach(el =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.closest(&#39;.position-field&#39;).style.display = &#39;flex&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.setAttribute(&#39;required&#39;, &#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.querySelectorAll(&#39;[name=&quot;currentPrice&quot;]&#39;).forEach(el =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el.closest(&#39;.position-field&#39;).style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">}</span></p><p class="c1"><span class="c0">// &#23450;&#26399;&#25552;&#37266;&#20633;&#20221;</span></p><p class="c1"><span class="c0">function checkBackupReminder() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const lastBackup = localStorage.getItem(&#39;lastBackup&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const now = new Date().getTime();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!lastBackup || (now - parseInt(lastBackup)) &gt; 7 * 24 * 60 * 60 * 1000) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (trades.length &gt; 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert(&#39;&#128190; &#25552;&#37266;&#65306;&#24314;&#35696;&#23450;&#26399;&#19979;&#36617;&#20633;&#20221;&#24744;&#30340;&#20132;&#26131;&#26085;&#35468;&#65281;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; localStorage.setItem(&#39;lastBackup&#39;, now.toString());</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">// &#38913;&#38754;&#36617;&#20837;&#26178;&#27298;&#26597;</span></p><p class="c1"><span class="c0">window.addEventListener(&#39;load&#39;, checkBackupReminder);</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">// &#19979;&#36617;&#26178;&#26356;&#26032;&#20633;&#20221;&#26178;&#38291;</span></p><p class="c1"><span class="c0">function downloadHTML() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const blob = new Blob([document.documentElement.outerHTML], {type: &#39;text/html&#39;});</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const a = document.createElement(&#39;a&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.href = URL.createObjectURL(blob);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.download = `&#20132;&#26131;&#26085;&#35468;_${new Date().toISOString().split(&#39;T&#39;)[0]}.html`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.click();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; localStorage.setItem(&#39;lastBackup&#39;, new Date().getTime().toString()); // &#26032;&#22686;&#36889;&#34892;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function addPosition() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; positionCounter++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const container = document.getElementById(&#39;positionsContainer&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const div = document.createElement(&#39;div&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; div.className = &#39;position-item&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; div.id = `position-${positionCounter}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; div.innerHTML = `</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;button type=&quot;button&quot; class=&quot;remove-position-btn&quot; onclick=&quot;removePosition(${positionCounter})&quot;&gt;&times;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#21830;&#21697;&#39006;&#22411; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select name=&quot;productType&quot; required onchange=&quot;handleProductTypeChange(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;stock&quot;&gt;&#20491;&#32929;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;futures&quot;&gt;&#26399;&#36008;/&#25351;&#25976;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot; id=&quot;symbolField-${positionCounter}&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#32929;&#31080;&#20195;&#34399;/&#21517;&#31281; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; name=&quot;symbol&quot; placeholder=&quot;&#20363;: 2330 &#21488;&#31309;&#38651;&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field hidden&quot; id=&quot;futuresTypeField-${positionCounter}&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#26399;&#36008;&#39006;&#22411; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select name=&quot;futuresType&quot; onchange=&quot;calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#20491;&#32929;&#26399;&#36008;&quot;&gt;&#20491;&#32929;&#26399;&#36008; (1&#21475;=2000&#32929;)&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#24494;&#22411;&#21488;&#25351;&quot;&gt;&#24494;&#22411;&#21488;&#25351; (1&#40670;=$10)&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#23567;&#22411;&#21488;&#25351;&quot;&gt;&#23567;&#22411;&#21488;&#25351; (1&#40670;=$50)&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#21488;&#25351;&#26399;&quot;&gt;&#21488;&#25351;&#26399; (1&#40670;=$200)&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot; id=&quot;instrumentField-${positionCounter}&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#20132;&#26131;&#24037;&#20855; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select name=&quot;instrument&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#34701;&#36039;&quot;&gt;&#34701;&#36039;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#34701;&#21048;&quot;&gt;&#34701;&#21048;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#29694;&#32929;&quot;&gt;&#29694;&#32929;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#22810;&#31354;&#26041;&#21521; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;select name=&quot;direction&quot; required onchange=&quot;updateStyle(${positionCounter}); calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&quot;&gt;&#35531;&#36984;&#25799;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#20570;&#22810;&quot;&gt;&#20570;&#22810;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;option value=&quot;&#20570;&#31354;&quot;&gt;&#20570;&#31354;&lt;/option&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/select&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label id=&quot;entryLabel-${positionCounter}&quot;&gt;&#36914;&#22580;&#20729;&#26684; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;decimal&quot; name=&quot;entryPrice&quot; placeholder=&quot;0.00&quot; required oninput=&quot;calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label id=&quot;currentLabel-${positionCounter}&quot;&gt;&#25910;&#30436;&#20729;/&#29694;&#20729;&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;decimal&quot; name=&quot;currentPrice&quot; class=&quot;current-price-field&quot; placeholder=&quot;&#36664;&#20837;&#29694;&#20729;&#35336;&#31639;&#25613;&#30410;&quot; oninput=&quot;calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label id=&quot;exitLabel-${positionCounter}&quot;&gt;&#20986;&#22580;&#20729;&#26684; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;decimal&quot; name=&quot;exitPrice&quot; placeholder=&quot;0.00&quot; required oninput=&quot;calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-field&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label id=&quot;quantityLabel-${positionCounter}&quot;&gt;&#20132;&#26131;&#24373;&#25976; *&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;numeric&quot; name=&quot;quantity&quot; placeholder=&quot;1000&quot; required oninput=&quot;calcPnL(${positionCounter})&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;position-pnl&quot; id=&quot;pnl-${positionCounter}&quot;&gt;&#38928;&#20272;&#30408;&#34407;: $0.00&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; `;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; container.appendChild(div);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; toggleExitFields();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function removePosition(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (document.querySelectorAll(&#39;.position-item&#39;).length &lt;= 1) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; alert(&#39;&#33267;&#23569;&#38656;&#35201;&#20445;&#30041;&#19968;&#20491;&#20132;&#26131;&#37096;&#20301;!&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(`position-${id}`)?.remove();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function handleProductTypeChange(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const div = document.getElementById(`position-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const type = div.querySelector(&#39;[name=&quot;productType&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const symbolField = document.getElementById(`symbolField-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const futuresField = document.getElementById(`futuresTypeField-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const instrumentField = document.getElementById(`instrumentField-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (type === &#39;futures&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; symbolField.classList.add(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; futuresField.classList.remove(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; instrumentField.classList.add(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;symbol&quot;]&#39;).removeAttribute(&#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;futuresType&quot;]&#39;).setAttribute(&#39;required&#39;, &#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;instrument&quot;]&#39;).removeAttribute(&#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`entryLabel-${id}`).textContent = &#39;&#36914;&#22580;&#40670;&#20301; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`currentLabel-${id}`).textContent = &#39;&#25910;&#30436;&#40670;&#20301;/&#29694;&#20729;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`exitLabel-${id}`).textContent = &#39;&#20986;&#22580;&#40670;&#20301; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`quantityLabel-${id}`).textContent = &#39;&#20132;&#26131;&#21475;&#25976; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.classList.add(&#39;futures&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; symbolField.classList.remove(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; futuresField.classList.add(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; instrumentField.classList.remove(&#39;hidden&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;symbol&quot;]&#39;).setAttribute(&#39;required&#39;, &#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;futuresType&quot;]&#39;).removeAttribute(&#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.querySelector(&#39;[name=&quot;instrument&quot;]&#39;).setAttribute(&#39;required&#39;, &#39;required&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`entryLabel-${id}`).textContent = &#39;&#36914;&#22580;&#20729;&#26684; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`currentLabel-${id}`).textContent = &#39;&#25910;&#30436;&#20729;/&#29694;&#20729;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`exitLabel-${id}`).textContent = &#39;&#20986;&#22580;&#20729;&#26684; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; document.getElementById(`quantityLabel-${id}`).textContent = &#39;&#20132;&#26131;&#32929;&#25976; *&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.classList.remove(&#39;futures&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; calcPnL(id);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function updateStyle(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const div = document.getElementById(`position-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const dir = div.querySelector(&#39;[name=&quot;direction&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; div.classList.remove(&#39;long&#39;, &#39;short&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (dir === &#39;&#20570;&#22810;&#39;) div.classList.add(&#39;long&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; else if (dir === &#39;&#20570;&#31354;&#39;) div.classList.add(&#39;short&#39;);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function getPointValue(futuresType) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (futuresType === &#39;&#20491;&#32929;&#26399;&#36008;&#39;) return 2000;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (futuresType === &#39;&#24494;&#22411;&#21488;&#25351;&#39;) return 10;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (futuresType === &#39;&#23567;&#22411;&#21488;&#25351;&#39;) return 50;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (futuresType === &#39;&#21488;&#25351;&#26399;&#39;) return 200;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; return 0;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function calculatePnL(type, futuresType, direction, entryPrice, exitPrice, quantity) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let pnl = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (type === &#39;futures&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const pv = getPointValue(futuresType);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const diff = direction === &#39;&#20570;&#22810;&#39; ? exitPrice - entryPrice : entryPrice - exitPrice;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; pnl = diff * pv * quantity;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; // &#20491;&#32929;&#35336;&#31639;:&#20729;&#24046; * &#24373;&#25976; * 1000&#32929;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const diff = direction === &#39;&#20570;&#22810;&#39; ? exitPrice - entryPrice : entryPrice - exitPrice;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; pnl = diff * quantity * 1000; &nbsp;// &larr; &#21152;&#19978; * 1000</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; return pnl;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function calcPnL(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const div = document.getElementById(`position-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!div) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const type = div.querySelector(&#39;[name=&quot;productType&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const dir = div.querySelector(&#39;[name=&quot;direction&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const entry = parseFloat(div.querySelector(&#39;[name=&quot;entryPrice&quot;]&#39;).value) || 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const current = parseFloat(div.querySelector(&#39;[name=&quot;currentPrice&quot;]&#39;).value) || 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const exit = parseFloat(div.querySelector(&#39;[name=&quot;exitPrice&quot;]&#39;).value) || 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const qty = parseFloat(div.querySelector(&#39;[name=&quot;quantity&quot;]&#39;).value) || 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const status = document.getElementById(&#39;positionStatus&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const pnlEl = document.getElementById(`pnl-${id}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const ft = div.querySelector(&#39;[name=&quot;futuresType&quot;]&#39;)?.value || &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (status === &#39;open&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (current &gt; 0 &amp;&amp; entry &gt; 0 &amp;&amp; qty &gt; 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const pnl = calculatePnL(type, ft, dir, entry, current, qty);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlEl.textContent = `&#26410;&#23526;&#29694;&#25613;&#30410;: $${pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlEl.style.color = pnl &gt;= 0 ? &#39;#28a745&#39; : &#39;#dc3545&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlEl.textContent = &#39;&#26410;&#24179;&#20489;(&#25345;&#20489;&#20013;)&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlEl.style.color = &#39;#ffc107&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (exit &gt; 0 &amp;&amp; entry &gt; 0 &amp;&amp; qty &gt; 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const pnl = calculatePnL(type, ft, dir, entry, exit, qty);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; pnlEl.textContent = `&#38928;&#20272;&#30408;&#34407;: $${pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; pnlEl.style.color = pnl &gt;= 0 ? &#39;#28a745&#39; : &#39;#dc3545&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">document.getElementById(&#39;tradeForm&#39;).addEventListener(&#39;submit&#39;, function(e) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; e.preventDefault();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const status = document.getElementById(&#39;positionStatus&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const positions = [];</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.querySelectorAll(&#39;.position-item&#39;).forEach(div =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const type = div.querySelector(&#39;[name=&quot;productType&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const dir = div.querySelector(&#39;[name=&quot;direction&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const entry = parseFloat(div.querySelector(&#39;[name=&quot;entryPrice&quot;]&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const current = parseFloat(div.querySelector(&#39;[name=&quot;currentPrice&quot;]&#39;).value) || null;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const exit = status === &#39;closed&#39; ? parseFloat(div.querySelector(&#39;[name=&quot;exitPrice&quot;]&#39;).value) : null;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const qty = parseFloat(div.querySelector(&#39;[name=&quot;quantity&quot;]&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; let pos = {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; productType: type,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; direction: dir,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; entryPrice: entry,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentPrice: current,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exitPrice: exit,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; quantity: qty</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; };</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (type === &#39;stock&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.symbol = div.querySelector(&#39;[name=&quot;symbol&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.instrument = div.querySelector(&#39;[name=&quot;instrument&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.futuresType = div.querySelector(&#39;[name=&quot;futuresType&quot;]&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (status === &#39;closed&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.pnl = calculatePnL(type, pos.futuresType, dir, entry, exit, qty);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } else if (current) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.unrealizedPnL = calculatePnL(type, pos.futuresType, dir, entry, current, qty);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; positions.push(pos);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let totalUnrealized = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (status === &#39;open&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; positions.forEach(p =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.currentPrice) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalUnrealized += calculatePnL(</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.productType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.futuresType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.direction,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.entryPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.currentPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.quantity</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; id: Date.now(),</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; date: document.getElementById(&#39;date&#39;).value,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; status: status,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; strategy: document.getElementById(&#39;strategy&#39;).value,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; judgement: status === &#39;closed&#39; ? document.getElementById(&#39;judgement&#39;).value : null,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; positions: positions,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; totalPnL: status === &#39;closed&#39; ? positions.reduce((s, p) =&gt; s + (p.pnl || 0), 0) : 0,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; unrealizedPnL: totalUnrealized,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; entryReason: document.getElementById(&#39;entryReason&#39;).value,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; exitReason: status === &#39;closed&#39; ? document.getElementById(&#39;exitReason&#39;).value : null,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; notes: document.getElementById(&#39;notes&#39;).value</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; };</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trades.push(trade);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; localStorage.setItem(&#39;trades&#39;, JSON.stringify(trades));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; alert(`&#9989; &#20132;&#26131;&#35352;&#37636;&#24050;&#26032;&#22686;!${status === &#39;open&#39; &amp;&amp; totalUnrealized !== 0 ? `\n&#26410;&#23526;&#29694;&#25613;&#30410;: $${totalUnrealized.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}` : &#39;&#39;}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; this.reset();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;date&#39;).valueAsDate = new Date();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;positionStatus&#39;).value = &#39;closed&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;positionsContainer&#39;).innerHTML = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; positionCounter = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; addPosition();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; toggleExitFields();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displayTrades();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; updateStats();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; initializeSettlementYears();</span></p><p class="c1"><span class="c0">});</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function displayTrades() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const tbody = document.getElementById(&#39;tradeBody&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; tbody.innerHTML = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trades.sort((a, b) =&gt; new Date(b.date) - new Date(a.date)).forEach(trade =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const row = tbody.insertRow();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (trade.status === &#39;open&#39;) row.classList.add(&#39;open-position&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const posText = trade.positions.map(p =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let info = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.productType === &#39;stock&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info = `${p.symbol} ${p.instrument} ${p.direction} ${p.quantity}&#32929;&lt;br&gt;&#36914;: $${p.entryPrice}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.exitPrice) info += ` &rarr; &#20986;: $${p.exitPrice}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.currentPrice &amp;&amp; trade.status === &#39;open&#39;) </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info += `&lt;br&gt;&lt;span style=&quot;color:#ff9800;&quot;&gt;&#29694;&#20729;: $${p.currentPrice}&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info = `${p.futuresType} ${p.direction} ${p.quantity}&#21475;&lt;br&gt;&#36914;: ${p.entryPrice}&#40670;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.exitPrice) info += ` &rarr; &#20986;: ${p.exitPrice}&#40670;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.currentPrice &amp;&amp; trade.status === &#39;open&#39;) </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info += `&lt;br&gt;&lt;span style=&quot;color:#ff9800;&quot;&gt;&#29694;&#20729;: ${p.currentPrice}&#40670;&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return info;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }).join(&#39;&lt;br&gt;&lt;br&gt;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const statusBadge = trade.status === &#39;open&#39; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? &#39;&lt;span class=&quot;badge badge-open&quot;&gt;&#26410;&#24179;&#20489;&lt;/span&gt;&#39; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : &#39;&lt;span class=&quot;badge badge-closed&quot;&gt;&#24050;&#24179;&#20489;&lt;/span&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; let pnlDisplay = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (trade.status === &#39;open&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (trade.unrealizedPnL !== undefined &amp;&amp; trade.unrealizedPnL !== 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const pnlClass = trade.unrealizedPnL &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlDisplay = `&lt;span class=&quot;unrealized&quot;&gt;&#26410;&#23526;&#29694;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;${pnlClass}&quot;&gt;$${trade.unrealizedPnL.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlDisplay = &#39;&lt;span class=&quot;unrealized&quot;&gt;&#25345;&#20489;&#20013;&lt;/span&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlDisplay = `&lt;span class=&quot;${trade.totalPnL &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;}&quot;&gt;$${trade.totalPnL.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const actions = trade.status === &#39;open&#39; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? `&lt;button class=&quot;edit-btn&quot; onclick=&quot;openEditModal(${trade.id})&quot;&gt;&#32232;&#36655;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button class=&quot;close-btn&quot; onclick=&quot;openCloseModal(${trade.id})&quot;&gt;&#24179;&#20489;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;button class=&quot;delete-btn&quot; onclick=&quot;deleteTrade(${trade.id})&quot;&gt;&#21034;&#38500;&lt;/button&gt;`</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : `&lt;button class=&quot;delete-btn&quot; onclick=&quot;deleteTrade(${trade.id})&quot;&gt;&#21034;&#38500;&lt;/button&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; row.innerHTML = `</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${statusBadge}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.date}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td style=&quot;font-size:12px;&quot;&gt;${posText}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.strategy}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${pnlDisplay}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.entryReason}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.exitReason || &#39;-&#39;}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td class=&quot;${trade.judgement === &#39;&#27491;&#30906;&#39; ? &#39;correct&#39; : trade.judgement === &#39;&#37679;&#35492;&#39; ? &#39;incorrect&#39; : &#39;&#39;}&quot;&gt;${trade.judgement || &#39;-&#39;}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.notes || &#39;-&#39;}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td style=&quot;white-space:nowrap;&quot;&gt;${actions}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; `;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function updateStats() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const open = trades.filter(t =&gt; t.status === &#39;open&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalPnL = closed.reduce((s, t) =&gt; s + t.totalPnL, 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalUnrealized = open.reduce((s, t) =&gt; s + (t.unrealizedPnL || 0), 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const wins = closed.filter(t =&gt; t.totalPnL &gt; 0).length;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const correct = closed.filter(t =&gt; t.judgement === &#39;&#27491;&#30906;&#39;).length;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;totalTrades&#39;).textContent = closed.length;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;totalPnL&#39;).textContent = `$${totalPnL.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const realizedCard = document.getElementById(&#39;realizedPnLCard&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; realizedCard.className = &#39;stat-card&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (totalPnL &gt; 0) realizedCard.classList.add(&#39;profit-card&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; else if (totalPnL &lt; 0) realizedCard.classList.add(&#39;loss-card&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;unrealizedPnL&#39;).textContent = `$${totalUnrealized.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;openPositionsCount&#39;).textContent = open.length;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;winRate&#39;).textContent = closed.length &gt; 0 ? `${((wins / closed.length) * 100).toFixed(1)}%` : &#39;0%&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;correctRate&#39;).textContent = closed.length &gt; 0 ? `${((correct / closed.length) * 100).toFixed(1)}%` : &#39;0%&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1"><span class="c0">function openEditModal(tradeId) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = trades.find(t =&gt; t.id === tradeId);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!trade) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;editTradeId&#39;).value = tradeId;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const container = document.getElementById(&#39;editPositionsContainer&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; container.innerHTML = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.positions.forEach((pos, idx) =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const name = pos.productType === &#39;stock&#39; ? pos.symbol : pos.futuresType;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const unit = pos.productType === &#39;stock&#39; ? &#39;&#20803;&#39; : &#39;&#40670;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const currentVal = pos.currentPrice || &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const div = document.createElement(&#39;div&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.className = &#39;price-update-row&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.innerHTML = `</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;${name}&lt;/label&gt;&lt;br&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;small style=&quot;color:#666;&quot;&gt;${pos.direction} ${pos.quantity}${pos.productType === &#39;stock&#39; ? &#39;&#32929;&#39; : &#39;&#21475;&#39;} @ ${pos.entryPrice}${unit}&lt;/small&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;&#25910;&#30436;&#20729;/&#29694;&#20729; (${unit})&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;decimal&quot; class=&quot;edit-current-price&quot; data-idx=&quot;${idx}&quot; value=&quot;${currentVal}&quot; placeholder=&quot;&#36664;&#20837;&#29694;&#20729;&quot; oninput=&quot;calcEditUnrealized()&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;pos-unrealized&quot; id=&quot;edit-unrealized-${idx}&quot; style=&quot;font-weight:bold; text-align:center;&quot;&gt;--&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; `;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; container.appendChild(div);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; calcEditUnrealized();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;editPositionModal&#39;).style.display = &#39;block&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function calcEditUnrealized() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const tradeId = parseInt(document.getElementById(&#39;editTradeId&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = trades.find(t =&gt; t.id === tradeId);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!trade) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let totalUnrealized = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.querySelectorAll(&#39;.edit-current-price&#39;).forEach(input =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const idx = parseInt(input.dataset.idx);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const currentPrice = parseFloat(input.value) || 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const pos = trade.positions[idx];</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const displayEl = document.getElementById(`edit-unrealized-${idx}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (currentPrice &gt; 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const pnl = calculatePnL(</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.productType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.futuresType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.direction,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.entryPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.quantity</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalUnrealized += pnl;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; displayEl.innerHTML = `&lt;span style=&quot;color:${pnl &gt;= 0 ? &#39;#28a745&#39; : &#39;#dc3545&#39;}&quot;&gt;$${pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; displayEl.innerHTML = &#39;--&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalDisplay = document.getElementById(&#39;editTotalUnrealized&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; totalDisplay.textContent = `&#32317;&#26410;&#23526;&#29694;&#25613;&#30410;: $${totalUnrealized.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; totalDisplay.className = &#39;total-unrealized&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (totalUnrealized &gt; 0) totalDisplay.classList.add(&#39;profit&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; else if (totalUnrealized &lt; 0) totalDisplay.classList.add(&#39;loss&#39;);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">document.getElementById(&#39;editPositionForm&#39;).addEventListener(&#39;submit&#39;, function(e) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; e.preventDefault();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const tradeId = parseInt(document.getElementById(&#39;editTradeId&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = trades.find(t =&gt; t.id === tradeId);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!trade) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let totalUnrealized = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.querySelectorAll(&#39;.edit-current-price&#39;).forEach(input =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const idx = parseInt(input.dataset.idx);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const currentPrice = parseFloat(input.value) || null;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].currentPrice = currentPrice;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (currentPrice) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const pnl = calculatePnL(</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].productType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].futuresType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].direction,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].entryPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; currentPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].quantity</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; totalUnrealized += pnl;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].unrealizedPnL = pnl;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.unrealizedPnL = totalUnrealized;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; localStorage.setItem(&#39;trades&#39;, JSON.stringify(trades));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; alert(`&#9989; &#26410;&#24179;&#20489;&#37096;&#20301;&#24050;&#26356;&#26032;!\n&#26410;&#23526;&#29694;&#25613;&#30410;: $${totalUnrealized.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; closeModal(&#39;editPositionModal&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displayTrades();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; updateStats();</span></p><p class="c1"><span class="c0">});</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function openCloseModal(tradeId) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = trades.find(t =&gt; t.id === tradeId);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!trade) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;closeTradeId&#39;).value = tradeId;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;closeDate&#39;).valueAsDate = new Date();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const container = document.getElementById(&#39;closePositionsContainer&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; container.innerHTML = &#39;&lt;h3 style=&quot;margin: 15px 0; color: #667eea;&quot;&gt;&#35373;&#23450;&#20986;&#22580;&#20729;&#26684;&lt;/h3&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.positions.forEach((pos, idx) =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const name = pos.productType === &#39;stock&#39; ? pos.symbol : pos.futuresType;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const unit = pos.productType === &#39;stock&#39; ? &#39;&#20803;&#39; : &#39;&#40670;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const defaultVal = pos.currentPrice || &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const div = document.createElement(&#39;div&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.className = &#39;form-group&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.innerHTML = `</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;label&gt;${name} - ${pos.direction} (&#36914;&#22580;: ${pos.entryPrice}${unit})&lt;/label&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;input type=&quot;text&quot; inputmode=&quot;decimal&quot; class=&quot;close-exit-price&quot; data-index=&quot;${idx}&quot; placeholder=&quot;&#20986;&#22580;&#20729;&#26684;/&#40670;&#20301;&quot; value=&quot;${defaultVal}&quot; required&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ${pos.currentPrice ? `&lt;small style=&quot;color:#666;&quot;&gt;&#25552;&#31034;:&#24050;&#33258;&#21205;&#24118;&#20837;&#29694;&#20729; ${pos.currentPrice}${unit}&lt;/small&gt;` : &#39;&#39;}</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; `;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; container.appendChild(div);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;closePositionModal&#39;).style.display = &#39;block&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function showOpenPositionsModal() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const open = trades.filter(t =&gt; t.status === &#39;open&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const container = document.getElementById(&#39;openPositionsList&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (open.length === 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; container.innerHTML = &#39;&lt;p style=&quot;text-align:center; color:#999; padding:20px;&quot;&gt;&#30446;&#21069;&#27794;&#26377;&#26410;&#24179;&#20489;&#37096;&#20301;&lt;/p&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; let html = &#39;&lt;table style=&quot;width:100%; margin:0;&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;&#26085;&#26399;&lt;/th&gt;&lt;th&gt;&#37096;&#20301;&lt;/th&gt;&lt;th&gt;&#26410;&#23526;&#29694;&#25613;&#30410;&lt;/th&gt;&lt;th&gt;&#25805;&#20316;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; open.forEach(trade =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const posText = trade.positions.map(p =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let info = p.productType === &#39;stock&#39; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? `${p.symbol} ${p.direction} ${p.quantity}&#32929; @ ${p.entryPrice}` </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : `${p.futuresType} ${p.direction} ${p.quantity}&#21475; @ ${p.entryPrice}&#40670;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (p.currentPrice) info += ` (&#29694;&#20729;: ${p.currentPrice})`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return info;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }).join(&#39;&lt;br&gt;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let pnlDisplay = &#39;--&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (trade.unrealizedPnL !== undefined &amp;&amp; trade.unrealizedPnL !== 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const cls = trade.unrealizedPnL &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pnlDisplay = `&lt;span class=&quot;${cls}&quot;&gt;$${trade.unrealizedPnL.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/span&gt;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; html += `</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;tr&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${trade.date}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td style=&quot;font-size:12px;&quot;&gt;${posText}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td&gt;${pnlDisplay}&lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;td style=&quot;white-space:nowrap;&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class=&quot;edit-btn&quot; onclick=&quot;closeModal(&#39;openPositionsModal&#39;); openEditModal(${trade.id})&quot;&gt;&#32232;&#36655;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;button class=&quot;close-btn&quot; onclick=&quot;closeModal(&#39;openPositionsModal&#39;); openCloseModal(${trade.id})&quot;&gt;&#24179;&#20489;&lt;/button&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/td&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/tr&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; `;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; html += &#39;&lt;/tbody&gt;&lt;/table&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; container.innerHTML = html;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;openPositionsModal&#39;).style.display = &#39;block&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function closeModal(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(id).style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">document.getElementById(&#39;closePositionForm&#39;).addEventListener(&#39;submit&#39;, function(e) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; e.preventDefault();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const tradeId = parseInt(document.getElementById(&#39;closeTradeId&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const trade = trades.find(t =&gt; t.id === tradeId);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!trade) return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.querySelectorAll(&#39;.close-exit-price&#39;).forEach((input, idx) =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; trade.positions[idx].exitPrice = parseFloat(input.value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const pos = trade.positions[idx];</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; pos.pnl = calculatePnL(</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.productType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.futuresType,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.direction,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.entryPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.exitPrice,</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pos.quantity</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; );</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.status = &#39;closed&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.exitReason = document.getElementById(&#39;closeExitReason&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.judgement = document.getElementById(&#39;closeJudgement&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.totalPnL = trade.positions.reduce((s, p) =&gt; s + p.pnl, 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.unrealizedPnL = 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trade.closeDate = document.getElementById(&#39;closeDate&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; localStorage.setItem(&#39;trades&#39;, JSON.stringify(trades));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; alert(&#39;&#9989; &#37096;&#20301;&#24050;&#24179;&#20489;!&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; closeModal(&#39;closePositionModal&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displayTrades();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; updateStats();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; initializeSettlementYears();</span></p><p class="c1"><span class="c0">});</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function deleteTrade(id) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (confirm(&#39;&#30906;&#23450;&#35201;&#21034;&#38500;&#27492;&#20132;&#26131;&#35352;&#37636;&#21966;?&#39;)) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; trades = trades.filter(t =&gt; t.id !== id);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; localStorage.setItem(&#39;trades&#39;, JSON.stringify(trades));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; displayTrades();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; updateStats();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; initializeSettlementYears();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function clearAllData() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (confirm(&#39;&#9888;&#65039; &#30906;&#23450;&#35201;&#28165;&#31354;&#25152;&#26377;&#20132;&#26131;&#35352;&#37636;&#21966;?&#39;)) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; trades = [];</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; localStorage.removeItem(&#39;trades&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; displayTrades();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; updateStats();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; initializeSettlementYears();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; alert(&#39;&#9989; &#25152;&#26377;&#35352;&#37636;&#24050;&#28165;&#31354;!&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function downloadHTML() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const blob = new Blob([document.documentElement.outerHTML], {type: &#39;text/html&#39;});</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const a = document.createElement(&#39;a&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.href = URL.createObjectURL(blob);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.download = `&#20132;&#26131;&#26085;&#35468;_${new Date().toISOString().split(&#39;T&#39;)[0]}.html`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.click();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function exportCSV() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let csv = &#39;\uFEFF&#29376;&#24907;,&#26085;&#26399;,&#21830;&#21697;,&#26041;&#21521;,&#36914;&#22580;,&#20986;&#22580;,&#29694;&#20729;,&#25976;&#37327;,&#24050;&#23526;&#29694;&#25613;&#30410;,&#26410;&#23526;&#29694;&#25613;&#30410;,&#38918;&#36870;&#21218;,&#36914;&#22580;&#21407;&#22240;,&#20986;&#22580;&#21407;&#22240;,&#21028;&#26039;,&#20633;&#35387;\n&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; trades.forEach(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; t.positions.forEach((p, i) =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const sym = p.productType === &#39;stock&#39; ? p.symbol : p.futuresType;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const unrealizedPnL = t.status === &#39;open&#39; &amp;&amp; p.currentPrice </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ? calculatePnL(p.productType, p.futuresType, p.direction, p.entryPrice, p.currentPrice, p.quantity) </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csv += `${t.status === &#39;open&#39; ? &#39;&#26410;&#24179;&#20489;&#39; : &#39;&#24050;&#24179;&#20489;&#39;},${t.date},${sym},${p.direction},${p.entryPrice},${p.exitPrice || &#39;-&#39;},${p.currentPrice || &#39;-&#39;},${p.quantity},${(p.pnl || 0).toFixed(2)},${unrealizedPnL.toFixed(2)},`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; csv += i === 0 ? `${t.strategy},&quot;${t.entryReason}&quot;,&quot;${t.exitReason || &#39;&#39;}&quot;,${t.judgement || &#39;&#39;},&quot;${t.notes || &#39;&#39;}&quot;\n` : &#39;,,,,\n&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const blob = new Blob([csv], {type: &#39;text/csv;charset=utf-8;&#39;});</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const a = document.createElement(&#39;a&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.href = URL.createObjectURL(blob);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.download = `&#20132;&#26131;&#35352;&#37636;_${new Date().toISOString().split(&#39;T&#39;)[0]}.csv`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.click();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function initializeSettlementYears() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const years = [...new Set(closed.map(t =&gt; new Date(t.date).getFullYear()))].sort((a, b) =&gt; b - a);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (years.length === 0) years.push(new Date().getFullYear());</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;settlementYear&#39;).innerHTML = years.map(y =&gt; `&lt;option value=&quot;${y}&quot;&gt;${y}&#24180;&lt;/option&gt;`).join(&#39;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; updateSettlementMonths();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function updateSettlementMonths() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const year = parseInt(document.getElementById(&#39;settlementYear&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const months = [...new Set(closed.filter(t =&gt; new Date(t.date).getFullYear() === year).map(t =&gt; new Date(t.date).getMonth() + 1))].sort((a, b) =&gt; b - a);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (months.length === 0) months.push(new Date().getMonth() + 1);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; document.getElementById(&#39;settlementMonth&#39;).innerHTML = months.map(m =&gt; `&lt;option value=&quot;${m}&quot;&gt;${m}&#26376;&lt;/option&gt;`).join(&#39;&#39;);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function isWeekday(d) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const day = d.getDay();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; return day !== 0 &amp;&amp; day !== 6;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function getWeekNum(d) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; return Math.ceil((d.getDate() + new Date(d.getFullYear(), d.getMonth(), 1).getDay()) / 7);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function generateDailySettlement() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const year = parseInt(document.getElementById(&#39;settlementYear&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const month = parseInt(document.getElementById(&#39;settlementMonth&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const monthTrades = closed.filter(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const d = new Date(t.date);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return d.getFullYear() === year &amp;&amp; d.getMonth() + 1 === month;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const data = {};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const days = new Date(year, month, 0).getDate();</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; for (let i = 1; i &lt;= days; i++) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const d = new Date(year, month - 1, i);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (isWeekday(d)) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const ds = d.toISOString().split(&#39;T&#39;)[0];</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[ds] = {date: ds, trades: 0, pnl: 0, wins: 0, losses: 0};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; monthTrades.forEach(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (data[t.date]) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[t.date].trades++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data[t.date].pnl += t.totalPnL;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (t.totalPnL &gt; 0) data[t.date].wins++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (t.totalPnL &lt; 0) data[t.date].losses++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementData = Object.values(data).sort((a, b) =&gt; a.date.localeCompare(b.date));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementType = &#39;daily&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displaySettlement(&#39;&#26085;&#32080;&#31639;&#39;, year, month);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function generateWeeklySettlement() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const year = parseInt(document.getElementById(&#39;settlementYear&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const month = parseInt(document.getElementById(&#39;settlementMonth&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const monthTrades = closed.filter(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const d = new Date(t.date);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return d.getFullYear() === year &amp;&amp; d.getMonth() + 1 === month;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const data = {};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; monthTrades.forEach(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const wk = `&#31532;${getWeekNum(new Date(t.date))}&#36913;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (!data[wk]) data[wk] = {week: wk, trades: 0, pnl: 0, wins: 0, losses: 0, days: new Set()};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[wk].trades++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[wk].pnl += t.totalPnL;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[wk].days.add(t.date);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (t.totalPnL &gt; 0) data[wk].wins++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; else if (t.totalPnL &lt; 0) data[wk].losses++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementData = Object.values(data).map(w =&gt; ({...w, tradingDays: w.days.size}));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementType = &#39;weekly&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displaySettlement(&#39;&#36913;&#32080;&#31639;&#39;, year, month);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function generateMonthlySettlement() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const year = parseInt(document.getElementById(&#39;settlementYear&#39;).value);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const closed = trades.filter(t =&gt; t.status === &#39;closed&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const yearTrades = closed.filter(t =&gt; new Date(t.date).getFullYear() === year);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const data = {};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; for (let m = 1; m &lt;= 12; m++) data[m] = {month: `${m}&#26376;`, trades: 0, pnl: 0, wins: 0, losses: 0, days: new Set()};</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; yearTrades.forEach(t =&gt; {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; const m = new Date(t.date).getMonth() + 1;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[m].trades++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[m].pnl += t.totalPnL;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; data[m].days.add(t.date);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; if (t.totalPnL &gt; 0) data[m].wins++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; else if (t.totalPnL &lt; 0) data[m].losses++;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; });</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementData = Object.values(data).filter(m =&gt; m.trades &gt; 0).map(m =&gt; ({...m, tradingDays: m.days.size}));</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; currentSettlementType = &#39;monthly&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; displaySettlement(&#39;&#26376;&#32080;&#31639;&#39;, year);</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function displaySettlement(title, year, month = null) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const div = document.getElementById(&#39;settlementResult&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!currentSettlementData || currentSettlementData.length === 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; div.innerHTML = &#39;&lt;p style=&quot;text-align:center; padding:20px; color:#999;&quot;&gt;&#27492;&#26399;&#38291;&#27794;&#26377;&#24050;&#24179;&#20489;&#30340;&#20132;&#26131;&#35352;&#37636;&lt;/p&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalPnL = currentSettlementData.reduce((s, d) =&gt; s + d.pnl, 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalTrades = currentSettlementData.reduce((s, d) =&gt; s + d.trades, 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const totalWins = currentSettlementData.reduce((s, d) =&gt; s + d.wins, 0);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const winRate = totalTrades &gt; 0 ? ((totalWins / totalTrades) * 100).toFixed(1) : 0;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let headers = &#39;&#39;, rows = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (currentSettlementType === &#39;daily&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; headers = &#39;&lt;th&gt;&#26085;&#26399;&lt;/th&gt;&lt;th&gt;&#20132;&#26131;&#27425;&#25976;&lt;/th&gt;&lt;th&gt;&#30408;&#34407;&#37329;&#38989;&lt;/th&gt;&lt;th&gt;&#29554;&#21033;&lt;/th&gt;&lt;th&gt;&#34407;&#25613;&lt;/th&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; rows = currentSettlementData.map(d =&gt; `&lt;tr&gt;&lt;td&gt;${d.date}&lt;/td&gt;&lt;td&gt;${d.trades}&lt;/td&gt;&lt;td class=&quot;${d.pnl &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;}&quot;&gt;$${d.pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/td&gt;&lt;td&gt;${d.wins}&lt;/td&gt;&lt;td&gt;${d.losses}&lt;/td&gt;&lt;/tr&gt;`).join(&#39;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else if (currentSettlementType === &#39;weekly&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; headers = &#39;&lt;th&gt;&#36913;&#27425;&lt;/th&gt;&lt;th&gt;&#20132;&#26131;&#22825;&#25976;&lt;/th&gt;&lt;th&gt;&#20132;&#26131;&#27425;&#25976;&lt;/th&gt;&lt;th&gt;&#30408;&#34407;&#37329;&#38989;&lt;/th&gt;&lt;th&gt;&#29554;&#21033;&lt;/th&gt;&lt;th&gt;&#34407;&#25613;&lt;/th&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; rows = currentSettlementData.map(d =&gt; `&lt;tr&gt;&lt;td&gt;${d.week}&lt;/td&gt;&lt;td&gt;${d.tradingDays}&lt;/td&gt;&lt;td&gt;${d.trades}&lt;/td&gt;&lt;td class=&quot;${d.pnl &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;}&quot;&gt;$${d.pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/td&gt;&lt;td&gt;${d.wins}&lt;/td&gt;&lt;td&gt;${d.losses}&lt;/td&gt;&lt;/tr&gt;`).join(&#39;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; headers = &#39;&lt;th&gt;&#26376;&#20221;&lt;/th&gt;&lt;th&gt;&#20132;&#26131;&#22825;&#25976;&lt;/th&gt;&lt;th&gt;&#20132;&#26131;&#27425;&#25976;&lt;/th&gt;&lt;th&gt;&#30408;&#34407;&#37329;&#38989;&lt;/th&gt;&lt;th&gt;&#29554;&#21033;&lt;/th&gt;&lt;th&gt;&#34407;&#25613;&lt;/th&gt;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; rows = currentSettlementData.map(d =&gt; `&lt;tr&gt;&lt;td&gt;${d.month}&lt;/td&gt;&lt;td&gt;${d.tradingDays}&lt;/td&gt;&lt;td&gt;${d.trades}&lt;/td&gt;&lt;td class=&quot;${d.pnl &gt;= 0 ? &#39;profit&#39; : &#39;loss&#39;}&quot;&gt;$${d.pnl.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/td&gt;&lt;td&gt;${d.wins}&lt;/td&gt;&lt;td&gt;${d.losses}&lt;/td&gt;&lt;/tr&gt;`).join(&#39;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const period = month ? `${year}&#24180;${month}&#26376;` : `${year}&#24180;`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; div.innerHTML = `&lt;table style=&quot;margin:0;&quot;&gt;&lt;thead&gt;&lt;tr&gt;${headers}&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;${rows}&lt;/tbody&gt;&lt;/table&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;settlement-summary ${totalPnL &lt; 0 ? &#39;negative&#39; : &#39;&#39;}&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;h3&gt;&#128202; ${period} ${title}&#32113;&#35336;&lt;/h3&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;summary-grid&quot;&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;summary-item&quot;&gt;&lt;div class=&quot;label&quot;&gt;&#32317;&#20132;&#26131;&#27425;&#25976;&lt;/div&gt;&lt;div class=&quot;value&quot;&gt;${totalTrades}&lt;/div&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;summary-item&quot;&gt;&lt;div class=&quot;label&quot;&gt;&#32317;&#30408;&#34407;&lt;/div&gt;&lt;div class=&quot;value&quot;&gt;$${totalPnL.toLocaleString(&#39;zh-TW&#39;, {minimumFractionDigits: 2})}&lt;/div&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;summary-item&quot;&gt;&lt;div class=&quot;label&quot;&gt;&#21213;&#29575;&lt;/div&gt;&lt;div class=&quot;value&quot;&gt;${winRate}%&lt;/div&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;summary-item&quot;&gt;&lt;div class=&quot;label&quot;&gt;&#29554;&#21033;&#27425;&#25976;&lt;/div&gt;&lt;div class=&quot;value&quot;&gt;${totalWins}&lt;/div&gt;&lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;`;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">function exportSettlementCSV() {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (!currentSettlementData || currentSettlementData.length === 0) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; alert(&#39;&#9888;&#65039; &#35531;&#20808;&#29986;&#29983;&#32080;&#31639;&#22577;&#34920;&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; return;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const year = document.getElementById(&#39;settlementYear&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const month = document.getElementById(&#39;settlementMonth&#39;).value;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; let csv = &#39;\uFEFF&#39;, filename = &#39;&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (currentSettlementType === &#39;daily&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; csv += &#39;&#26085;&#26399;,&#20132;&#26131;&#27425;&#25976;,&#30408;&#34407;&#37329;&#38989;,&#29554;&#21033;&#27425;&#25976;,&#34407;&#25613;&#27425;&#25976;\n&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; currentSettlementData.forEach(d =&gt; csv += `${d.date},${d.trades},${d.pnl.toFixed(2)},${d.wins},${d.losses}\n`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; filename = `&#26085;&#32080;&#31639;_${year}&#24180;${month}&#26376;.csv`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else if (currentSettlementType === &#39;weekly&#39;) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; csv += &#39;&#36913;&#27425;,&#20132;&#26131;&#22825;&#25976;,&#20132;&#26131;&#27425;&#25976;,&#30408;&#34407;&#37329;&#38989;,&#29554;&#21033;&#27425;&#25976;,&#34407;&#25613;&#27425;&#25976;\n&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; currentSettlementData.forEach(d =&gt; csv += `${d.week},${d.tradingDays},${d.trades},${d.pnl.toFixed(2)},${d.wins},${d.losses}\n`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; filename = `&#36913;&#32080;&#31639;_${year}&#24180;${month}&#26376;.csv`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; } else {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; csv += &#39;&#26376;&#20221;,&#20132;&#26131;&#22825;&#25976;,&#20132;&#26131;&#27425;&#25976;,&#30408;&#34407;&#37329;&#38989;,&#29554;&#21033;&#27425;&#25976;,&#34407;&#25613;&#27425;&#25976;\n&#39;;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; currentSettlementData.forEach(d =&gt; csv += `${d.month},${d.tradingDays},${d.trades},${d.pnl.toFixed(2)},${d.wins},${d.losses}\n`);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; filename = `&#26376;&#32080;&#31639;_${year}&#24180;.csv`;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; }</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; </span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const blob = new Blob([csv], {type: &#39;text/csv;charset=utf-8;&#39;});</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; const a = document.createElement(&#39;a&#39;);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.href = URL.createObjectURL(blob);</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.download = filename;</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; a.click();</span></p><p class="c1"><span class="c0">}</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1"><span class="c0">window.onclick = function(e) {</span></p><p class="c1"><span class="c0">&nbsp; &nbsp; if (e.target.classList.contains(&#39;modal&#39;)) e.target.style.display = &#39;none&#39;;</span></p><p class="c1"><span class="c0">}</span></p><p class="c1"><span class="c0">&nbsp; &lt;/script&gt;</span></p><p class="c1"><span class="c0">&lt;/body&gt;</span></p><p class="c1"><span class="c0">&lt;/html&gt;</span></p><p class="c1 c2"><span class="c0"></span></p><p class="c1 c2"><span class="c0"></span></p></body></html>